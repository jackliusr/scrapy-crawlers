from scrapy.selector import Selector
from scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor
from scrapy.contrib.spiders import CrawlSpider, Rule
from scrapy.spider import BaseSpider
from crawlers.items import G5173Item
from scrapy.http import TextResponse,FormRequest,Request
import json
from scrapy import log

class G5173Spider(CrawlSpider):
    name = 'g5173'
    allowed_domains = ['5173.com']
    start_urls = ['http://www.5173.com/']

    start_urls = ['http://s.5173.com/dnf.shtml',
		  'http://s.5173.com/bns.shtml',
		  'http://s.5173.com/search/2fdfb7d3fcd84b97b1e702d02c9ee7a7.shtml',
		  'http://s.5173.com/search/a36ead01453c40b584f8e1e687723f2d.shtml',
		  'http://s.5173.com/search/20c8bbc1b9794fc98bd96859624d4769.shtml',
		  'http://s.5173.com/search/f3823b6683834acdbfbd82f67b394b88.shtml',
		  'http://s.5173.com/wow.shtml',
		  'http://s.5173.com/search/773b0a3451164d9ea00b719b01ac1e10.shtml',
		  'http://s.5173.com/search/900a5c6341c94b9f8b918219dd5c9d9e.shtml',
		  'http://s.5173.com/search/31565c8c8b51434cb2090debeaeb80ac.shtml',
		  'http://s.5173.com/dn.shtml',
		  'http://s.5173.com/search/da451dc0df8d40e9a7aa54842687a127.shtml',
		  'http://s.5173.com/search/a0f93027884b4a1089650c1ba9fa9e69.shtml',
		  'http://s.5173.com/search/3971da6971b3483987caa24bdfb30425.shtml',
		  'http://s.5173.com/search/c2925c77d1a749c0b1b2b3324d5785f7.shtml',
		  'http://s.5173.com/mu.shtml',
		  'http://s.5173.com/search/cadf72f401484ef4bf6e2a918fab7558.shtml',
		  'http://s.5173.com/search/43045ba1d93347fd92774c375580e9e6.shtml',
		  'http://s.5173.com/search/1322.shtml',
		  'http://s.5173.com/search/3241.shtml',
		  'http://s.5173.com/search/1154.shtml',
		  'http://s.5173.com/search/070c12bc0c4a48a7a10d8bd2ec23aec4.shtml',
		  'http://s.5173.com/search/2d7611f6dcf24689bad1774ff16e80ba.shtml',
		  'http://s.5173.com/search/b54458d3aaf14cf98a099762107e1702.shtml',
		  'http://s.5173.com/pem.shtml',
		  'http://s.5173.com/search/9161e4c4044c4f10943b6530359ecce6.shtml',
		  'http://s.5173.com/aion.shtml',
		  'http://s.5173.com/search/05e5fdabec934126b355d8c239975339.shtml',
		  'http://s.5173.com/lol.shtml',
		  'http://s.5173.com/search/c95fe472dde6408bb7306d3aab09671e.shtml',
		  'http://s.5173.com/h2.shtml',
		  'http://s.5173.com/search/5a842f4c794f413bb9c3f9302f1ed227.shtml',
		  'http://s.5173.com/search/0db80df2ab83473490a0245b04c64c13.shtml',
		  'http://s.5173.com/search/455e21127728494392e83668faa549ed.shtml',
		  'http://s.5173.com/search/a986bb72b3c3480f9664c46cf07c2a5f.shtml',
		  'http://s.5173.com/search/b2062182a4384f2dbbe18479d86138d9.shtml',
		  'http://s.5173.com/search/4922a47ead904390bf00f2bfdf5b076c.shtml',
		  'http://s.5173.com/ffo.shtml',
		  'http://s.5173.com/search/865f355e45324274b1ae10a2706810b8.shtml',
		  'http://s.5173.com/CSOL.shtml',
		  'http://s.5173.com/search/b2da8cb4edce4b07bcb2551860e6f42c.shtml',
		  'http://s.5173.com/search/1900.shtml',
		  'http://s.5173.com/search/6487960014104ae0a6d3852cae3424f3.shtml',
		  'http://s.5173.com/cf.shtml',
		  'http://s.5173.com/search/14e08487b9284b66aecc32eb9e1a9ae2.shtml',
		  'http://s.5173.com/search/dac3cabb11454d818e0461f8fcca0387.shtml',
		  'http://s.5173.com/search/786b504ffadb4a9c970542975518927c.shtml',
		  'http://s.5173.com/search/7cc2a518498d42958489677bbd03f682.shtml',
		  'http://s.5173.com/search/f77f2d30ef254dfa9d16bcff204781bf.shtml',
		  'http://s.5173.com/search/b26cab24eb4c4fcb82b7ce2a0a63a1d6.shtml',
		  'http://s.5173.com/search/87c1026b419e472c93a84776a3e7cf48.shtml',
		  'http://s.5173.com/search/ec583909245e43d38911456bf408086b.shtml',
		  'http://s.5173.com/search/ac09372cbe46477da002622282ce81b6.shtml',
		  'http://s.5173.com/search/2231790ed805480ebb3bf82d220e268b.shtml',
		  'http://s.5173.com/search/1027fcb2ee7a448a8e9a5eca50e69183.shtml',
		  'http://s.5173.com/search/b47a7b31e79147bd9108743126430727.shtml',
		  'http://s.5173.com/search/c62bff2d798e45eeb56da1ab2aef84d9.shtml',
		  'http://s.5173.com/search/2c5291cde8094e4cb8001f6c1670fb87.shtml',
		  'http://s.5173.com/search/fe9ddb5ed5274cf2b8ebec75aacba674.shtml',
		  'http://s.5173.com/search/1ab2750626944554910d3db0aca0c4d9.shtml',
		  'http://s.5173.com/search/f817ac404a1641b7820ee1446ba4185b.shtml',
		  'http://s.5173.com/search/97af17b6b3fb4f8c95dda37c2421c90b.shtml',
		  'http://s.5173.com/search/5481a38a75be4caa83f0d1b65e8fab6d.shtml',
		  'http://s.5173.com/search/40af4cf4b9014e01856cc5cc0a11fe19.shtml',
		  'http://s.5173.com/mir.shtml',
		  'http://s.5173.com/search/614811c38bb74995bc109b4962b6009a.shtml',
		  'http://s.5173.com/search/dce2be1e0f534d16a1b31f52a1d09b39.shtml',
		  'http://s.5173.com/search/4a6e6a36ab594367850653ac01259d1f.shtml',
		  'http://s.5173.com/search/bf3d2c140c4848199b99cf9b7ee2450e.shtml',
		  'http://s.5173.com/search/a1c131f82fd449d09f316bd0488f785a.shtml',
		  'http://s.5173.com/search/e6f4328d83444f4f99f604d75b523ac8.shtml',
		  'http://s.5173.com/search/3794f2fb55fe42d8bbb5621e0a19a061.shtml',
		  'http://s.5173.com/search/801e4a6ddc794f899b4dc9919f92dc1a.shtml',
		  'http://s.5173.com/search/e170d773a2bd404baba8b7443a025aa0.shtml',
		  'http://s.5173.com/search/2545.shtml',
		  'http://s.5173.com/search/2249625489c14c31b5d9743b8f6b9c10.shtml',
		  'http://s.5173.com/search/607bc885bfda4fcda7f540be8a42f128.shtml',
		  'http://s.5173.com/search/2ae2ac3230a4485283fdfa28fa569d64.shtml',
		  'http://s.5173.com/search/bf233bcf27d04ac18732b349fd454378.shtml',
		  'http://s.5173.com/search/14f9b115fd5d431fb361d1eaee131c7f.shtml',
		  'http://s.5173.com/search/e770cce2dc674193a49bd06bd43ff4f8.shtml',
		  'http://s.5173.com/search/eab4d9ebf4d54e1e9bc020fc36700745.shtml',
		  'http://s.5173.com/search/0446f5fea2744db1ad8a1f0dabee2f03.shtml',
		  'http://s.5173.com/search/d544f65716bc49c4b9748234c75f15f5.shtml',
		  'http://s.5173.com/search/97b09d61976946299d7e5ce5f77dd4c0.shtml',
		  'http://s.5173.com/c9.shtml',
		  'http://s.5173.com/search/1cc18bb4e9ba4de28c11580fc40f1edc.shtml',
		  'http://s.5173.com/search/4434f1e0bb1a4108acc369bbfe69942f.shtml',
		  'http://s.5173.com/search/73599f944d0f4ff8a83925b1726b6cbc.shtml',
		  'http://s.5173.com/search/144c3e52893c4a1788b7f7cb277fc5f9.shtml',
		  'http://s.5173.com/search/51960d3e460d4b7e8cc0ff549a81e38b.shtml',
		  'http://s.5173.com/search/ccd09f865c544754a532ac9fe5a2fd2c.shtml',
		  'http://s.5173.com/search/553cba68f38f4950829604df2020fef9.shtml',
		  'http://s.5173.com/search/4865623db7ec41738a2734dd2be2578f.shtml',
		  'http://s.5173.com/search/55494d4b77a243af988039ce576f30d3.shtml',
		  'http://s.5173.com/search/4032ae7273fa4623ac293a8fcb65571a.shtml',
		  'http://s.5173.com/search/885c5a5c541543458f25425f578f940d.shtml',
		  'http://s.5173.com/search/3055d34c48ef470092ef87a3c81dc962.shtml',
		  'http://s.5173.com/search/234d6f36d28a4905b0944b6377972c19.shtml',
		  'http://s.5173.com/search/431aff34f4ff42179fa01c9e35ec780f.shtml',
		  'http://s.5173.com/search/42b31905355040a285f499a57f882e3f.shtml',
		  'http://s.5173.com/search/fb8c34040aae4491b41c2ac1d26c24f2.shtml',
		  'http://s.5173.com/search/0b315176598043b9ab3a86129a92758d.shtml',
		  'http://s.5173.com/search/5806bd9782ad46a087cb3b233d704f20.shtml',
		  'http://s.5173.com/search/94454041c965471783cad18d7df65920.shtml',
		  'http://s.5173.com/search/158028fc9f074c919f8e8aba2f5be71c.shtml',
		  'http://s.5173.com/search/199de9fa0873411f8f5d175a9c114080.shtml',
		  'http://s.5173.com/search/9c61716351f74bf49c6535478a335951.shtml',
		  'http://s.5173.com/search/5925b8638573417a8060cb5dc14163d1.shtml',
		  'http://s.5173.com/search/3192a1712ff341959083ddf20e8f96ef.shtml',
		  'http://s.5173.com/search/1b7371fc649b4fae8dd7502aef2568c2.shtml',
		  'http://s.5173.com/search/ee52c33221244ee099d2af7ee4402a13.shtml',
		  'http://s.5173.com/search/177a7be91a3444338e0a44d9fbc3ac45.shtml',
		  'http://s.5173.com/search/2d1dc8b3adc04671a5f8803181437e48.shtml',
		  'http://s.5173.com/search/58cfd984ec7143ebb06a0cdc6a1d3674.shtml',
		  'http://s.5173.com/search/5ed5ddd6b85d4ef58dcca966858f2289.shtml',
		  'http://s.5173.com/search/216e0b39a43840518cd6b3c09c687e7f.shtml',
		  'http://s.5173.com/search/f91fbb3f0df142be8f107ab855236b50.shtml',
		  'http://s.5173.com/search/a8a583d63bed43a98c776825f987a64c.shtml',
		  'http://s.5173.com/search/aa8346a136d24f7b913358a162411993.shtml',
		  'http://s.5173.com/search/cdeb481108dc4420b48cad51f420cad5.shtml',
		  'http://s.5173.com/search/0725c34d0d424b8898465c86a28f6bac.shtml',
		  'http://s.5173.com/search/005ce24a980b48f4b360b390f1835c8a.shtml',
		  'http://s.5173.com/search/0add73c09eb6476aa0f52ae412b4ef0e.shtml',
		  'http://s.5173.com/search/0be370b0f3304d9abd1352579930fee4.shtml',
		  'http://s.5173.com/search/121ba592c1804c15a160b55f4e0949bd.shtml',
		  'http://s.5173.com/search/158ec9b4811840b9b68b4d20e1b14520.shtml',
		  'http://s.5173.com/search/3ed8483631644a9f90f39091f54f2634.shtml',
		  'http://s.5173.com/search/e8d058a210e64b8aa20789852bfca469.shtml',
		  'http://s.5173.com/search/49de3d3c548f455084f8eaf5421e8265.shtml',
		  'http://s.5173.com/search/8d6108ddfb30496cabe8d07772dc20ce.shtml',
		  'http://s.5173.com/search/2a4ccaf7fbcf4615a44b7a923b4a1a92.shtml',
		  'http://s.5173.com/search/319522a68d3c40958094df8482a26d98.shtml',
		  'http://s.5173.com/search/7528b65705bf45ceb66b80123f1b71d0.shtml',
		  'http://s.5173.com/search/c921ba3f5f6541f9bd525cd4e3edf24e.shtml'
		  ]

    rules = (
	Rule(SgmlLinkExtractor(allow=r'consignment\.5173\.com/detail/.*.shtml'), callback='parse_item', follow=False),
    )
      
    def parse_item(self, response):
	sel = Selector(response)
	i = G5173Item()
	i['name'] = sel.xpath("//h1[@id='textTitle']/text()").extract()[0]
	i['description'] = ' '.join(sel.xpath("//div[@id='bizOfferInfo_cnt']/*").extract())
	i['category'] = sel.xpath("//div[@class='detail_nav']/a[2]/text()").extract()[0]
	i['price'] = sel.xpath("//span[@id='lblPrice']/text()").extract()[0] + 'RMB'
	i['image_urls'] = sel.xpath("//img[@id='imgLogo']/@src").extract()
	return i;
